<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Glow Cart - Premium digital products marketplace with a futuristic cosmic design">
  <meta name="theme-color" content="#0a0a23">
  <title>Glow Cart - Shop the Digital Universe</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
    
    :root {
      --primary: #00f2fe;
      --primary-dark: #00c2cc;
      --secondary: #4facfe;
      --accent: #f857a6;
      --dark: #0a0a23;
      --darker: #050518;
      --light: #ffffff;
      --gray: #9ca3af;
      --card-bg: rgba(26, 26, 58, 0.7);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: linear-gradient(180deg, var(--darker) 0%, #1a1a3a 100%);
      min-height: 100vh;
      overflow-x: hidden;
      color: var(--light);
      font-family: 'Inter', sans-serif;
    }
    
    /* Audio Player Styles */
    .custom-audio-player {
      filter: hue-rotate(180deg) brightness(1.5);
      border-radius: 20px;
      background: rgba(0, 242, 254, 0.1);
    }
    
    .custom-audio-player::-webkit-media-controls-panel {
      background: rgba(10, 10, 35, 0.8);
      border-radius: 20px;
    }
    
    .custom-audio-player::-webkit-media-controls-play-button,
    .custom-audio-player::-webkit-media-controls-mute-button {
      filter: invert(1) hue-rotate(180deg);
    }
    
    .custom-audio-player::-webkit-media-controls-current-time-display,
    .custom-audio-player::-webkit-media-controls-time-remaining-display {
      color: #00f2fe;
    }
    
    .custom-audio-player::-webkit-media-controls-timeline {
      background-color: rgba(0, 242, 254, 0.2);
      border-radius: 10px;
      height: 4px;
    }
    
    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(26, 26, 58, 0.2);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(var(--primary), var(--secondary));
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(var(--primary-dark), var(--secondary));
    }
    
    /* Grid Background */
    .grid-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: linear-gradient(
          0deg,
          transparent 24%,
          rgba(0, 255, 255, 0.1) 25%,
          transparent 27%,
          transparent 74%,
          rgba(0, 255, 255, 0.1) 75%,
          transparent 77%
        ),
        linear-gradient(
          90deg,
          transparent 24%,
          rgba(0, 255, 255, 0.1) 25%,
          transparent 27%,
          transparent 74%,
          rgba(0, 255, 255, 0.1) 75%,
          transparent 77%
        );
      background-size: 50px 50px;
      z-index: -1;
      opacity: 0.3;
      animation: gridMove 20s linear infinite;
    }
    
    /* Space Scene Elements */
    .space-scene {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      overflow: hidden;
      pointer-events: none;
    }
    
    .central-sphere {
      position: fixed;
      top: 50%;
      left: 15%;
      transform: translate(-50%, -50%);
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, var(--primary), var(--secondary));
      box-shadow: 0 0 60px 20px rgba(0, 242, 254, 0.5);
      opacity: 0.7;
      animation: pulse 8s ease-in-out infinite;
      z-index: -1;
    }
    
    .orbital-ring {
      position: absolute;
      top: 50%;
      left: 15%;
      transform: translate(-50%, -50%);
      border: 1px solid rgba(0, 242, 254, 0.3);
      border-radius: 50%;
      animation: rotate 20s linear infinite;
    }
    
    /* Glassmorphism */
    .glass {
      background: rgba(26, 26, 58, 0.25);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    /* Neon Elements */
    .neon-glow {
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.8), 0 0 20px rgba(0, 255, 255, 0.4);
    }
    
    .neon-text {
      text-shadow: 0 0 5px rgba(0, 255, 255, 0.5), 0 0 10px rgba(0, 255, 255, 0.3);
    }
    
    .neon-border {
      border: 1px solid rgba(0, 255, 255, 0.5);
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }
    
    /* Authentication Modal Styles */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fadeIn {
      animation: fadeIn 0.3s ease-out forwards;
    }
    
    /* Input focus glow effect */
    input:focus {
      box-shadow: 0 0 15px rgba(0, 242, 254, 0.4);
    }
    
    /* 3D Card Effect */
    .card-3d {
      perspective: 1000px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card-3d:hover {
      transform: rotateY(10deg) rotateX(5deg) scale(1.05);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), 0 0 15px rgba(0, 242, 254, 0.4);
    }
    
    .card-3d .card-content {
      transition: transform 0.3s ease;
    }
    
    .card-3d:hover .card-content {
      transform: translateZ(20px);
    }
    
    /* Buttons */
    .glow-button {
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      color: var(--darker);
      font-weight: 600;
      border: none;
      border-radius: 6px;
      padding: 10px 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .glow-button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(0, 242, 254, 0.7);
    }
    
    .glow-button:active {
      transform: scale(0.98);
    }
    
    .glow-button::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transform: rotate(45deg);
      transition: all 0.3s ease;
      opacity: 0;
    }
    
    .glow-button:hover::after {
      opacity: 1;
      animation: shine 1.5s ease-out;
    }
    
    /* Animations */
    @keyframes gridMove {
      0% { background-position: 0 0; }
      100% { background-position: 50px 50px; }
    }
    
    @keyframes pulse {
      0% { text-shadow: 0 0 5px rgba(0, 255, 255, 0.5); box-shadow: 0 0 30px rgba(0, 242, 254, 0.3); }
      50% { text-shadow: 0 0 20px rgba(0, 255, 255, 1); box-shadow: 0 0 60px rgba(0, 242, 254, 0.6); }
      100% { text-shadow: 0 0 5px rgba(0, 255, 255, 0.5); box-shadow: 0 0 30px rgba(0, 242, 254, 0.3); }
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }
    
    @keyframes shine {
      0% { left: -100%; opacity: 0; }
      20% { opacity: 1; }
      100% { left: 100%; opacity: 0; }
    }
    
    @keyframes rotate {
      from { transform: translate(-50%, -50%) rotate(0deg); }
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .header-text {
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(45deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: pulse 2s infinite;
    }
    
    .download-btn {
      background: linear-gradient(45deg, #00f2fe, #4facfe);
      transition: all 0.3s ease;
    }
    
    .download-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(0, 242, 254, 0.7);
    }
    
    /* Chatbot Styles */
    .chatbot-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      width: 320px;
      max-height: 480px;
      transition: all 0.3s ease;
      cursor: move;
      touch-action: none; /* Prevents default touch actions like scrolling */
      user-select: none; /* Prevents text selection */
      -webkit-user-select: none;
    }
    
    /* Dragging styles */
    .dragging {
      opacity: 0.8;
      box-shadow: 0 0 30px rgba(0, 242, 254, 0.8);
      transition: none; /* Disable transitions while dragging for better performance */
      will-change: left, top; /* Hint for browser to optimize these properties */
    }
    
    @keyframes pulsate {
      0% {
        transform: scale(1);
        box-shadow: 0 0 10px rgba(0, 242, 254, 0.5), 0 0 20px rgba(0, 242, 254, 0.3);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(0, 242, 254, 0.8), 0 0 30px rgba(0, 242, 254, 0.5);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 10px rgba(0, 242, 254, 0.5), 0 0 20px rgba(0, 242, 254, 0.3);
      }
    }
    
    .chatbot-button {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      color: var(--darker);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(0, 242, 254, 0.7), 0 0 30px rgba(0, 242, 254, 0.4);
      transition: all 0.3s ease;
      z-index: 1001;
      animation: pulsate 2s infinite ease-in-out;
      overflow: visible;
      position: relative;
      pointer-events: auto; /* Ensure clicks are detected */
    }
    
    /* Cute robot face in button */
    .chatbot-face {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }
    
    .chatbot-eyes {
      display: flex;
      justify-content: space-around;
      width: 60%;
      margin-bottom: 5px;
    }
    
    .chatbot-eye {
      width: 10px;
      height: 10px;
      background-color: var(--darker);
      border-radius: 50%;
      position: relative;
      animation: blink 4s infinite;
    }
    
    @keyframes blink {
      0%, 96%, 98% { transform: scaleY(1); }
      97% { transform: scaleY(0.1); }
    }
    
    .chatbot-mouth {
      width: 20px;
      height: 6px;
      background-color: var(--darker);
      border-radius: 10px;
      transition: all 0.3s ease;
    }
    
    .chatbot-button:hover .chatbot-mouth {
      height: 10px;
      border-radius: 5px 5px 10px 10px;
    }
    
    .chatbot-button-text {
      position: absolute;
      top: -30px;
      background: rgba(0, 242, 254, 0.2);
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      white-space: nowrap;
      color: white;
      font-weight: bold;
      box-shadow: 0 0 10px rgba(0, 242, 254, 0.5);
      opacity: 0.9;
      animation: fadeInUp 0.5s ease, pulsate 2s infinite ease-in-out;
    }
    
    .chatbot-button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 25px rgba(0, 242, 254, 0.9), 0 0 40px rgba(0, 242, 254, 0.6);
      animation-play-state: paused;
    }
    
    @keyframes popBubble {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      50% {
        transform: scale(1.05);
        opacity: 0.9;
      }
      75% {
        transform: scale(0.98);
        opacity: 1;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
    
    .chatbot-window {
      position: absolute;
      bottom: 80px;
      right: 0;
      width: 350px;
      height: 450px;
      border-radius: 20px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transform-origin: bottom right;
      transform: scale(0);
      opacity: 0;
      transition: all 0.3s ease;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), 0 0 20px rgba(0, 242, 254, 0.5);
    }
    
    .chatbot-window.active {
      animation: popBubble 0.5s forwards ease-out;
    }
    
    /* Chat bubble pointer */
    .chatbot-window:after {
      content: '';
      position: absolute;
      bottom: -10px;
      right: 25px;
      width: 20px;
      height: 20px;
      background: rgba(26, 26, 58, 0.9);
      transform: rotate(45deg);
      border-radius: 3px;
    }
    
    .chatbot-header {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: var(--darker);
      padding: 10px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 10px 10px 0 0;
      font-weight: bold;
      position: relative;
      overflow: hidden;
      cursor: move;
      touch-action: none; /* Prevents default touch actions */
      user-select: none; /* Prevents text selection */
      -webkit-user-select: none;
    }
    
    .chatbot-header::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
      animation: rainbow-border 3s linear infinite;
    }
    
    @keyframes rainbow-border {
      0% { background-position: 0% 0%; }
      100% { background-position: 200% 0%; }
    }
    
    .chatbot-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .chatbot-emoji-btn {
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
      padding: 0;
      transition: transform 0.3s ease;
      position: relative;
    }
    
    .chatbot-emoji-btn:hover {
      transform: scale(1.2);
    }
    
    .emoji-pop {
      animation: emoji-pop 0.3s ease;
    }
    
    @keyframes emoji-pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.4); }
      100% { transform: scale(1); }
    }
    
    .chatbot-close {
      cursor: pointer;
      font-size: 20px;
      transition: transform 0.3s ease;
    }
    
    .chatbot-close:hover {
      transform: rotate(90deg);
    }
    
    .chatbot-messages {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      background: rgba(10, 10, 35, 0.95);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .chatbot-message {
      max-width: 80%;
      padding: 10px 15px;
      border-radius: 15px;
      margin-bottom: 5px;
      animation: fadeInUp 0.3s ease;
      word-break: break-word;
    }
    
    /* Typing indicator */
    .typing-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px 15px;
      height: 35px;
    }
    
    .typing-indicator span {
      height: 8px;
      width: 8px;
      margin: 0 2px;
      background-color: rgba(0, 242, 254, 0.7);
      display: block;
      border-radius: 50%;
      opacity: 0.4;
    }
    
    .typing-indicator span:nth-of-type(1) {
      animation: typing 1s infinite 0.1s;
    }
    
    .typing-indicator span:nth-of-type(2) {
      animation: typing 1s infinite 0.2s;
    }
    
    .typing-indicator span:nth-of-type(3) {
      animation: typing 1s infinite 0.3s;
    }
    
    @keyframes typing {
      0% {
        transform: translateY(0px);
        opacity: 0.4;
      }
      50% {
        transform: translateY(-7px);
        opacity: 0.9;
      }
      100% {
        transform: translateY(0px);
        opacity: 0.4;
      }
    }
    
    .chatbot-message.bot {
      align-self: flex-start;
      background: rgba(26, 26, 58, 0.7);
      border-bottom-left-radius: 5px;
      color: white;
      position: relative;
    }
    
    .chatbot-message.bot::before {
      content: '';
      position: absolute;
      left: -30px;
      top: 50%;
      transform: translateY(-50%);
      width: 25px;
      height: 25px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2300f2fe"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm4-8c0 2.21-1.79 4-4 4s-4-1.79-4-4 1.79-4 4-4 4 1.79 4 4zm-2 0c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2z"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0.7;
    }
    
    .chatbot-message.user {
      align-self: flex-end;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      color: var(--darker);
      border-bottom-right-radius: 5px;
    }
    
    .chatbot-input-container {
      display: flex;
      padding: 10px;
      background: rgba(26, 26, 58, 0.9);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .chatbot-input {
      flex: 1;
      padding: 10px 15px;
      border: none;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      outline: none;
      transition: all 0.3s ease;
    }
    
    .chatbot-input:focus {
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 0 10px rgba(0, 242, 254, 0.3);
    }
    
    .chatbot-send {
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      color: var(--darker);
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-left: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .chatbot-send:hover {
      transform: scale(1.1);
    }
    
    .chatbot-product {
      background: rgba(26, 26, 58, 0.5);
      border-radius: 10px;
      padding: 12px;
      margin-top: 12px;
      border-left: 3px solid var(--primary);
      animation: fadeInUp 0.4s ease;
      transition: all 0.3s ease;
    }
    
    .chatbot-product:hover {
      background: rgba(26, 26, 58, 0.7);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .chatbot-product-image {
      width: 40px;
      height: 40px;
      border-radius: 5px;
      margin-right: 10px;
      object-fit: cover;
    }
    
    .chatbot-product-title {
      font-weight: bold;
      margin-bottom: 5px;
      color: var(--primary);
    }
    
    .chatbot-download-link {
      display: inline-block;
      margin-top: 8px;
      padding: 6px 12px;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      color: var(--darker);
      border-radius: 5px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    }
    
    .chatbot-download-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 242, 254, 0.4);
    }
    
    @keyframes pulse-download {
      0% {
        box-shadow: 0 0 0 0 rgba(0, 242, 254, 0.7);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(0, 242, 254, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(0, 242, 254, 0);
      }
    }
    
    .chatbot-download-link:active {
      transform: translateY(1px);
      animation: pulse-download 0.5s;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .central-sphere {
        width: 100px;
        height: 100px;
      }
      
      .chatbot-container {
        width: 300px;
      }
      
      .chatbot-window {
        width: 300px;
        height: 400px;
      }
    }
  </style>
</head>
<body>
  <div class="grid-bg"></div>
  <div class="space-scene">
    <div class="central-sphere"></div>
    <div class="orbital-ring" style="width: 300px; height: 300px;"></div>
    <div class="orbital-ring" style="width: 400px; height: 400px;"></div>
    <div class="orbital-ring" style="width: 500px; height: 500px;"></div>
  </div>
  <div id="root"></div>
  
  <!-- Chatbot Component (Non-React) -->
  <div class="chatbot-container" id="chatbotContainer">
    <div class="chatbot-button" id="chatbotButton">

      <div class="chatbot-face">
        <div class="chatbot-eyes">
          <div class="chatbot-eye"></div>
          <div class="chatbot-eye"></div>
        </div>
        <div class="chatbot-mouth"></div>
      </div>
    </div>
    <div class="chatbot-window" id="chatbotWindow">
      <div class="chatbot-header" id="chatbotHeader">
        <div>✨ GlowCart Assistant</div>
        <div class="chatbot-controls">
          <button class="chatbot-emoji-btn" id="chatbotEmoji" title="Send emoji">😊</button>
          <div class="chatbot-close" id="chatbotClose">&times;</div>
        </div>
      </div>
      <div class="chatbot-messages" id="chatbotMessages">
        <div class="chatbot-message bot">Hello! I'm your GlowCart assistant. If you've made a purchase, I can help you access your downloads. Just let me know!</div>
      </div>
      <div class="chatbot-input-container">
        <input type="text" class="chatbot-input" id="chatbotInput" placeholder="Type your message..." />
        <button class="chatbot-send" id="chatbotSend">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/framer-motion@10.12.16/dist/framer-motion.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Initialize chatbot functionality (outside of React)
    document.addEventListener('DOMContentLoaded', () => {
      // Add draggable functionality
      const makeDraggable = (element) => {
        const container = document.getElementById('chatbotContainer');
        const header = document.getElementById('chatbotHeader');
        
        let isDragging = false;
        let offsetX, offsetY;
        
        const startDrag = (e) => {
          // Allow dragging from anywhere in the container
          isDragging = true;
          container.classList.add('dragging');
          
          // Calculate the offset from the pointer to the container's top-left corner
          const rect = container.getBoundingClientRect();
          // Handle both mouse and touch events
          const clientX = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0);
          const clientY = e.clientY || (e.touches && e.touches[0] ? e.touches[0].clientY : 0);
          
          offsetX = clientX - rect.left;
          offsetY = clientY - rect.top;
          
          // Prevent text selection during drag
          document.body.style.userSelect = 'none';
          
          // Prevent default behavior for touch events to avoid scrolling
          if (e.type === 'touchstart') {
            e.preventDefault();
          }
        };
        
        const drag = (e) => {
          if (!isDragging) return;
          
          // Calculate new position - handle both mouse and touch events
          const clientX = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0);
          const clientY = e.clientY || (e.touches && e.touches[0] ? e.touches[0].clientY : 0);
          
          const x = clientX - offsetX;
          const y = clientY - offsetY;
          
          // Keep the chatbot within viewport bounds
          const viewportWidth = window.innerWidth;
          const viewportHeight = window.innerHeight;
          const chatbotWidth = container.offsetWidth;
          const chatbotHeight = container.offsetHeight;
          
          // Calculate bounds to keep at least 20% of the chatbot visible
          const minX = -chatbotWidth * 0.8;
          const maxX = viewportWidth - chatbotWidth * 0.2;
          const minY = 0; // Don't allow going above the top of the screen
          const maxY = viewportHeight - chatbotHeight * 0.2;
          
          // Apply bounded position
          const boundedX = Math.min(Math.max(x, minX), maxX);
          const boundedY = Math.min(Math.max(y, minY), maxY);
          
          // Apply new position
          container.style.left = `${boundedX}px`;
          container.style.top = `${boundedY}px`;
          container.style.right = 'auto';
          container.style.bottom = 'auto';
          
          // Prevent default behavior for touch events to avoid scrolling
          if (e.type === 'touchmove') {
            e.preventDefault();
          }
        };
        
        const endDrag = () => {
          if (!isDragging) return;
          
          isDragging = false;
          container.classList.remove('dragging');
          document.body.style.userSelect = '';
          
          // Save position to localStorage
          const rect = container.getBoundingClientRect();
          localStorage.setItem('chatbotPosition', JSON.stringify({
            left: rect.left,
            top: rect.top
          }));
        };
        
        // Restore position from localStorage if available
        const savedPosition = localStorage.getItem('chatbotPosition');
        if (savedPosition) {
          try {
            const { left, top } = JSON.parse(savedPosition);
            container.style.left = `${left}px`;
            container.style.top = `${top}px`;
            container.style.right = 'auto';
            container.style.bottom = 'auto';
          } catch (e) {
            console.error('Error restoring chatbot position:', e);
          }
        }
        
        // Add event listeners to the entire container
        container.addEventListener('mousedown', startDrag);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', endDrag);
        
        // Touch events for mobile
        container.addEventListener('touchstart', startDrag, { passive: false });
        document.addEventListener('touchmove', drag, { passive: false });
        document.addEventListener('touchend', endDrag);
        document.addEventListener('touchcancel', endDrag);
      };
      
      // Add emoji picker functionality
      const setupEmojiPicker = () => {
        const emojiButton = document.getElementById('chatbotEmoji');
        const emojis = ['😊', '👍', '❤️', '🎉', '🔥', '✨', '🌟', '💯', '🙏', '🤖'];
        let currentEmojiIndex = 0;
        
        emojiButton.addEventListener('click', () => {
          // Cycle through emojis
          currentEmojiIndex = (currentEmojiIndex + 1) % emojis.length;
          emojiButton.textContent = emojis[currentEmojiIndex];
          
          // Add emoji to input
          const input = document.getElementById('chatbotInput');
          input.value += emojis[currentEmojiIndex];
          input.focus();
          
          // Animate button
          emojiButton.classList.add('emoji-pop');
          setTimeout(() => emojiButton.classList.remove('emoji-pop'), 300);
        });
      };
      // Clear URL parameters after processing to prevent duplicate purchases on refresh
      const pageUrlParams = new URLSearchParams(window.location.search);
      const hasSessionId = pageUrlParams.has('session_id');
      const hasDownload = pageUrlParams.has('download');
      
      if (hasSessionId && hasDownload) {
        // Store the session ID for later use but clean the URL
        const pageSessionId = pageUrlParams.get('session_id');
        setTimeout(() => {
          // Replace the URL without the query parameters to prevent duplicates on refresh
          const cleanUrl = window.location.pathname;
          window.history.replaceState({}, document.title, cleanUrl);
        }, 2000); // Short delay to ensure all processes have time to read the parameters
      }
      const chatbotButton = document.getElementById('chatbotButton');
      const chatbotWindow = document.getElementById('chatbotWindow');
      const chatbotClose = document.getElementById('chatbotClose');
      const chatbotMessages = document.getElementById('chatbotMessages');
      const chatbotInput = document.getElementById('chatbotInput');
      const chatbotSend = document.getElementById('chatbotSend');
      
      // Initialize draggable functionality
      makeDraggable(document.getElementById('chatbotContainer'));
      
      // Initialize emoji picker
      setupEmojiPicker();
      
      let sessionId = null;
      
      // Get session ID from URL if available
      sessionId = pageUrlParams.get('session_id');
      
      // Auto-open chatbot if coming from a successful purchase
      if (sessionId && pageUrlParams.get('download') === 'true') {
        setTimeout(() => {
          chatbotWindow.classList.add('active');
          sendBotMessage("I see you've just completed a purchase! Let me fetch your downloads for you...");
          
          // Automatically fetch purchase info
          setTimeout(() => {
            sendChatbotMessage('show my downloads');
          }, 1000);
        }, 1500);
      }
      
      // First-time explanation of chatbot purpose
      let hasExplainedPurpose = localStorage.getItem('chatbotPurposeExplained');
      let firstOpen = true;
      
      // Toggle chatbot window with improved click handling
      chatbotButton.addEventListener('click', (e) => {
        // Prevent the click from being interpreted as the start of a drag
        e.stopPropagation();
        e.preventDefault();
        chatbotWindow.classList.toggle('active');
        
        // Show purpose explanation on first open
        if (firstOpen && !hasExplainedPurpose) {
          setTimeout(() => {
            sendBotMessage("Welcome to GlowCart Assistant! I'm here to help you with your purchases and provide easy access to your downloads. If you've made a purchase, I can show you all your PDF downloads. Just ask me to 'show my downloads' or 'help me find my files'.");
            localStorage.setItem('chatbotPurposeExplained', 'true');
            firstOpen = false;
          }, 500);
        }
      });
      
      // Close chatbot window
      chatbotClose.addEventListener('click', () => {
        chatbotWindow.classList.remove('active');
      });
      
      // Send message on Enter key
      chatbotInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendUserMessage();
        }
      });
      
      // Send message on button click
      chatbotSend.addEventListener('click', sendUserMessage);
      
      function sendUserMessage() {
        const message = chatbotInput.value.trim();
        if (message) {
          // Add user message to chat
          const userMessageElement = document.createElement('div');
          userMessageElement.classList.add('chatbot-message', 'user');
          userMessageElement.textContent = message;
          chatbotMessages.appendChild(userMessageElement);
          
          // Clear input
          chatbotInput.value = '';
          
          // Scroll to bottom
          chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
          
          // Process message
          sendChatbotMessage(message);
        }
      }
      
      function sendBotMessage(text, html = null) {
        // Check for duplicate messages to prevent duplicates
        const existingMessages = Array.from(chatbotMessages.querySelectorAll('.chatbot-message.bot'));
        const lastMessage = existingMessages[existingMessages.length - 1];
        
        // If this is a duplicate of the last message, don't add it
        if (lastMessage && lastMessage.textContent === text) {
          return;
        }
        
        const botMessageElement = document.createElement('div');
        botMessageElement.classList.add('chatbot-message', 'bot');
        
        if (html) {
          botMessageElement.innerHTML = text + html;
        } else {
          botMessageElement.textContent = text;
        }
        
        chatbotMessages.appendChild(botMessageElement);
        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
      }
      
      function sendChatbotMessage(message) {
        // If no session ID, inform user
        if (!sessionId) {
          sendBotMessage("I don't see any active session. If you've made a purchase, please refresh the page or check your email for download links.");
          return;
        }
        
        // Show typing indicator
        const typingIndicator = document.createElement('div');
        typingIndicator.classList.add('chatbot-message', 'bot', 'typing-indicator');
        typingIndicator.innerHTML = '<span></span><span></span><span></span>';
        chatbotMessages.appendChild(typingIndicator);
        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        
        // Send message to server
        fetch('/api/chatbot/message', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ sessionId, message }),
        })
        .then(response => response.json())
        .then(data => {
          // Remove typing indicator
          chatbotMessages.removeChild(typingIndicator);
          
          if (data.error) {
            sendBotMessage("Sorry, I encountered an error: " + data.error);
          } else {
            sendBotMessage(data.message, data.html);
          }
        })
        .catch(error => {
          // Remove typing indicator
          chatbotMessages.removeChild(typingIndicator);
          
          console.error('Error:', error);
          sendBotMessage("Sorry, I encountered an error while processing your request.");
        });
      }
    });

    const products = [
      { 
        id: 1, 
        title: "🔥 King Kong Vector Graphic Design (Digital Download)", 
        price: 9.99, 
        category: "Design", 
        rating: 4.7,
        reviews: 28,
        description: "Unleash the raw power of the mighty Kong in this meticulously crafted vector artwork. Every detail captures the iconic beast's fierce presence, from the intense expression to the dynamic pose. 🦍 Perfect for: T-shirts, posters, banners, social media, and brand projects. ✨ What's included: Layered vector files, high-res PNG/JPEG exports, and color variations. 📥 Instant digital download, ready for both print and digital use.",
        image: "kingkong.jpg", 
        fileUrl: "downloads/kingkong.pdf",
        featured: true,
        tags: ["design", "template", "futuristic"]
      },
      { 
        id: 2, 
        title: "🎵 Sounds Beyond the Stars (Digital Download)", 
        price: 4.99, 
        category: "Audio", 
        rating: 4.3,
        reviews: 15,
        description: "Journey through the cosmic soundscape where stellar winds whisper ancient secrets and nebulae hum their celestial lullabies. Each track captures the raw energy of newborn stars and the gentle pulse of distant galaxies. 🎧 Perfect for: Meditation, sci-fi projects, ambient backgrounds, and cosmic inspiration. 📥 Instant download includes: High-quality MP3s + bonus space ambience track.",
        image: "https://images.unsplash.com/photo-1614149162883-504ce4d13909?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80", 
        fileUrl: "downloads/alien-roar.mp3",
        featured: false,
        tags: ["audio", "music", "cyberpunk"]
      },
      { 
        id: 3, 
        title: "✨ Nebula Aura Template (Digital Download)", 
        price: 14.99, 
        category: "Template", 
        rating: 4.9,
        reviews: 42,
        description: "Transform your website into a gateway to the cosmos with this mesmerizing space-themed template. Features a stunning nebula-inspired design with smooth gradient effects and a clean, modern layout. 🌌 Includes: Homepage template, custom space-themed icons, and nebula background assets. 📥 Instant download with setup guide.",
        image: "nebu.jpg", 
        fileUrl: "downloads/nebu.pdf",
        featured: true,
        tags: ["web", "template", "space"]
      },
      { 
        id: 4, 
        title: "🌍 The First Woman, with Infinite Shades (Digital Download)", 
        price: 19.99, 
        category: "Art", 
        rating: 4.5,
        reviews: 36,
        description: "She Who Holds the Colors: A Portrait of Eve, Mother of Humanity,A powerful and symbolic digital portrait of Eve the first woman, the origin, the bearer of life and light.   🖼️ Perfect for: Wall art, prints, posters, spiritual decor, storytelling visuals and many more 📥 Instant digital download no physical item shipped.",
        image: "eve.jpg", 
        fileUrl: "downloads/eve.pdf",
        featured: false,
        tags: ["art", "digital", "collection"]
      },
      { 
        id: 5, 
        title: "⚡ Holographic Anime UI Kit (Digital Download)", 
        price: 24.99, 
        category: "UI/UX", 
        rating: 4.8,
        reviews: 52,
        description: "A sleek collection of holographic-style UI elements with a modern anime twist. Features clean, iridescent components that add a touch of futuristic flair to any interface. 🎨 Includes: Navigation menus, buttons, cards, and form elements with subtle rainbow effects. Perfect for: Modern websites, app interfaces, and digital projects. 📥 Instant download includes all source files.",
        image: "holo.jpg", 
        fileUrl: "downloads/holo.pdf",
        featured: true,
        tags: ["ui", "design", "holographic"]
      },
      { 
        id: 6, 
        title: "   Fractal Citadel (Digital Download)", 
        price: 29.99, 
        category: "3D", 
        rating: 4.6,
        reviews: 19,
        description: "Nestled within an endless void, the Fractal Citadel rises as a testament to the beauty of mathematical precision and otherworldly design, The citadel stands as a silent guardian of an unknown realm, inviting the viewer to lose themselves in its hypnotic depths, where chaos and order dance in perfect harmony. ✅ Usage: Personal and commercial use allowed, 📥 Instant digital download – no physical item shipped.",
        image: "3d.jpg", 
        fileUrl: "downloads/3d.pdf",
        featured: false,
        tags: ["3d", "space", "models"]
      }
    ];

    // Navigation component
    const Navigation = ({ cart, setIsCartOpen, isCartOpen, currentUser, onOpenAuthModal, onSignOut }) => {
      // Scroll to cart section when cart icon is clicked
      const handleCartClick = () => {
        setIsCartOpen(!isCartOpen);
        // Smooth scroll to cart section
        const cartSection = document.getElementById('cart');
        if (cartSection) {
          cartSection.scrollIntoView({ behavior: 'smooth' });
        }
      };
      
      return (
        <nav className="glass fixed top-0 left-0 right-0 z-50 px-6 py-4 flex justify-between items-center">
          <div className="flex items-center">
            <h1 className="text-2xl font-bold header-text">Glow<span className="text-cyan-400">Cart</span></h1>
          </div>
          <div className="hidden md:flex space-x-6">
            <a href="#" className="text-white hover:text-cyan-400 transition duration-300">Home</a>
            <a href="#products" className="text-white hover:text-cyan-400 transition duration-300">Products</a>
            <a href="#cart" className="text-white hover:text-cyan-400 transition duration-300">Cart</a>
            {currentUser && (
              <a href="#purchases" className="text-white hover:text-cyan-400 transition duration-300">Purchases</a>
            )}
          </div>
          <div className="flex items-center space-x-4">
            <button 
              className="relative group" 
              onClick={handleCartClick}
              aria-label="Shopping Cart"
            >
              <i className="fas fa-shopping-cart text-white text-xl group-hover:text-cyan-400 transition-colors duration-300"></i>
              <span className="absolute -top-2 -right-2 bg-cyan-500 text-xs text-black font-bold rounded-full w-5 h-5 flex items-center justify-center transition-all duration-300 group-hover:bg-cyan-400 group-hover:scale-110">{cart.length}</span>
              {cart.length > 0 && (
                <span className="absolute -bottom-8 right-0 bg-cyan-900/80 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap">View cart ({cart.length} items)</span>
              )}
            </button>
            
            {currentUser ? (
              <UserProfile user={currentUser} onSignOut={onSignOut} />
            ) : (
              <button 
                onClick={() => onOpenAuthModal('signin')}
                className="bg-gradient-to-r from-cyan-500 to-blue-500 text-black px-4 py-2 rounded-md hover:from-cyan-400 hover:to-blue-400 transition duration-300 neon-glow"
              >
                Sign In
              </button>
            )}
          </div>
        </nav>
      );
    };

    // Header/Hero component
    const Hero = () => {
      return (
        <div className="relative min-h-screen flex items-center justify-center px-4 py-20 mt-16">
          <div className="text-center z-10 max-w-4xl mx-auto">
            <h1 className="text-5xl md:text-7xl font-bold header-text mb-6 animate-pulse">
              Digital Universe Marketplace
            </h1>
            <p className="text-xl text-gray-300 mb-10 max-w-2xl mx-auto">
              Discover premium digital assets with futuristic design and cosmic themes for your next creative project.
            </p>
            <div className="flex flex-col sm:flex-row gap-4 justify-center">
              <button className="glow-button px-8 py-3 text-lg font-bold rounded-md">
                Explore Products
              </button>
              <button className="bg-transparent border border-cyan-500 text-cyan-400 px-8 py-3 text-lg font-bold rounded-md hover:bg-cyan-500/10 transition duration-300">
                Learn More
              </button>
            </div>
          </div>
        </div>
      );
    };

    // Authentication components
    const AuthModal = ({ isOpen, onClose, activeTab, setActiveTab }) => {
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [confirmPassword, setConfirmPassword] = useState('');
      const [error, setError] = useState('');
      const [success, setSuccess] = useState('');
      
      // Form validation
      const validateForm = () => {
        setError('');
        
        if (!username || !password) {
          setError('Please fill in all fields');
          return false;
        }
        
        if (username.length < 3) {
          setError('Username must be at least 3 characters');
          return false;
        }
        
        if (password.length < 6) {
          setError('Password must be at least 6 characters');
          return false;
        }
        
        if (activeTab === 'signup' && password !== confirmPassword) {
          setError('Passwords do not match');
          return false;
        }
        
        return true;
      };
      
      // Handle sign in
      const handleSignIn = (e) => {
        e.preventDefault();
        if (!validateForm()) return;
        
        // Check if user exists in localStorage
        const users = JSON.parse(localStorage.getItem('glowcart_users') || '[]');
        const user = users.find(u => u.username === username && u.password === password);
        
        if (!user) {
          setError('Invalid username or password');
          return;
        }
        
        // Set user in localStorage
        localStorage.setItem('glowcart_current_user', JSON.stringify({
          username: user.username,
          timestamp: new Date().getTime()
        }));
        
        setSuccess('Sign in successful!');
        
        // Clear form and close modal after a delay
        setTimeout(() => {
          setUsername('');
          setPassword('');
          setError('');
          setSuccess('');
          onClose();
          window.location.reload(); // Refresh to update UI
        }, 1000);
      };
      
      // Handle sign up
      const handleSignUp = (e) => {
        e.preventDefault();
        if (!validateForm()) return;
        
        // Check if username already exists
        const users = JSON.parse(localStorage.getItem('glowcart_users') || '[]');
        if (users.some(u => u.username === username)) {
          setError('Username already exists');
          return;
        }
        
        // Add new user
        users.push({
          username,
          password,
          createdAt: new Date().getTime()
        });
        
        localStorage.setItem('glowcart_users', JSON.stringify(users));
        
        // Set success message
        setSuccess('Account created successfully! You can now sign in.');
        
        // Clear form and switch to sign in tab after a delay
        setTimeout(() => {
          setUsername('');
          setPassword('');
          setConfirmPassword('');
          setError('');
          setSuccess('');
          setActiveTab('signin');
        }, 1500);
      };
      
      if (!isOpen) return null;
      
      return (
        <div className="fixed inset-0 flex items-center justify-center z-50">
          <div className="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onClick={onClose}></div>
          <div className="glass relative rounded-xl overflow-hidden w-full max-w-md p-6 shadow-2xl shadow-cyan-500/20 animate-fadeIn">
            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-400 to-blue-500"></div>
            
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-2xl font-bold header-text">
                {activeTab === 'signin' ? 'Sign In' : 'Create Account'}
              </h2>
              <button 
                onClick={onClose}
                className="text-gray-400 hover:text-white transition-colors"
                aria-label="Close"
              >
                <i className="fas fa-times"></i>
              </button>
            </div>
            
            <div className="flex mb-6">
              <button 
                className={`flex-1 py-2 text-center transition-colors ${activeTab === 'signin' ? 'text-cyan-400 border-b-2 border-cyan-400' : 'text-gray-400 hover:text-gray-300'}`}
                onClick={() => setActiveTab('signin')}
              >
                Sign In
              </button>
              <button 
                className={`flex-1 py-2 text-center transition-colors ${activeTab === 'signup' ? 'text-cyan-400 border-b-2 border-cyan-400' : 'text-gray-400 hover:text-gray-300'}`}
                onClick={() => setActiveTab('signup')}
              >
                Sign Up
              </button>
            </div>
            
            {error && (
              <div className="bg-red-500/20 border border-red-500/50 text-white px-4 py-2 rounded mb-4 animate-fadeIn">
                <i className="fas fa-exclamation-circle mr-2"></i>
                {error}
              </div>
            )}
            
            {success && (
              <div className="bg-green-500/20 border border-green-500/50 text-white px-4 py-2 rounded mb-4 animate-fadeIn">
                <i className="fas fa-check-circle mr-2"></i>
                {success}
              </div>
            )}
            
            <form onSubmit={activeTab === 'signin' ? handleSignIn : handleSignUp}>
              <div className="mb-4">
                <label className="block text-gray-300 mb-2" htmlFor="username">Username</label>
                <input 
                  type="text" 
                  id="username" 
                  className="w-full bg-gray-800/50 border border-gray-700 rounded px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all"
                  value={username}
                  onChange={(e) => setUsername(e.target.value)}
                  placeholder="Enter your username"
                  required
                />
              </div>
              
              <div className="mb-4">
                <label className="block text-gray-300 mb-2" htmlFor="password">Password</label>
                <input 
                  type="password" 
                  id="password" 
                  className="w-full bg-gray-800/50 border border-gray-700 rounded px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  placeholder="Enter your password"
                  required
                />
              </div>
              
              {activeTab === 'signup' && (
                <div className="mb-4">
                  <label className="block text-gray-300 mb-2" htmlFor="confirmPassword">Confirm Password</label>
                  <input 
                    type="password" 
                    id="confirmPassword" 
                    className="w-full bg-gray-800/50 border border-gray-700 rounded px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all"
                    value={confirmPassword}
                    onChange={(e) => setConfirmPassword(e.target.value)}
                    placeholder="Confirm your password"
                    required
                  />
                </div>
              )}
              
              <button 
                type="submit"
                className="w-full bg-gradient-to-r from-cyan-500 to-blue-500 text-black font-bold py-2 px-4 rounded hover:from-cyan-400 hover:to-blue-400 transition-all duration-300 mt-2"
              >
                {activeTab === 'signin' ? 'Sign In' : 'Create Account'}
              </button>
            </form>
            
            {activeTab === 'signin' && (
              <p className="text-center mt-4 text-gray-400 text-sm">
                Don't have an account? <button onClick={() => setActiveTab('signup')} className="text-cyan-400 hover:underline">Sign up</button>
              </p>
            )}
            
            {activeTab === 'signup' && (
              <p className="text-center mt-4 text-gray-400 text-sm">
                Already have an account? <button onClick={() => setActiveTab('signin')} className="text-cyan-400 hover:underline">Sign in</button>
              </p>
            )}
          </div>
        </div>
      );
    };
    
    // User Profile component
    const UserProfile = ({ user, onSignOut }) => {
      return (
        <div className="relative group">
          <button className="flex items-center space-x-2 bg-gray-800/50 hover:bg-gray-700/50 rounded-full px-4 py-2 transition-colors">
            <div className="w-8 h-8 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center text-black font-bold">
              {user.username.charAt(0).toUpperCase()}
            </div>
            <span className="text-white">{user.username}</span>
            <i className="fas fa-chevron-down text-gray-400 group-hover:text-white transition-colors"></i>
          </button>
          
          <div className="absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg overflow-hidden z-10 scale-0 group-hover:scale-100 origin-top-right transition-transform duration-200 ease-out">
            <div className="py-1">
              <a href="#purchases" className="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">
                <i className="fas fa-download mr-2"></i> My Purchases
              </a>
              <a href="#" className="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">
                <i className="fas fa-user-circle mr-2"></i> Profile
              </a>
              <button 
                onClick={onSignOut}
                className="w-full text-left block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors"
              >
                <i className="fas fa-sign-out-alt mr-2"></i> Sign Out
              </button>
            </div>
          </div>
        </div>
      );
    };
    
    function App() {
      const [cart, setCart] = useState([]);
      const [purchasedItems, setPurchasedItems] = useState([]);
      const [activeCategory, setActiveCategory] = useState('All');
      const [searchTerm, setSearchTerm] = useState('');
      const [previewProduct, setPreviewProduct] = useState(null);
      const [isCartOpen, setIsCartOpen] = useState(false);
      const [isAuthModalOpen, setIsAuthModalOpen] = useState(false);
      const [activeAuthTab, setActiveAuthTab] = useState('signin');
      const [currentUser, setCurrentUser] = useState(null);

      const stripe = Stripe('pk_test_YourPublicKey'); // Replace with your Stripe public key
      const [showChatbot, setShowChatbot] = useState(false);
      
      // Check if user is logged in on component mount
      useEffect(() => {
        const userJson = localStorage.getItem('glowcart_current_user');
        if (userJson) {
          const userData = JSON.parse(userJson);
          // Check if login is still valid (24 hours)
          const now = new Date().getTime();
          const loginTime = userData.timestamp;
          const hoursElapsed = (now - loginTime) / (1000 * 60 * 60);
          
          if (hoursElapsed < 24) {
            setCurrentUser(userData);
          } else {
            // Login expired, remove from localStorage
            localStorage.removeItem('glowcart_current_user');
          }
        }
      }, []);
      
      // Handle sign out
      const handleSignOut = () => {
        localStorage.removeItem('glowcart_current_user');
        setCurrentUser(null);
      };

      const initiateCheckout = () => {
        window.location.href = 'https://buy.stripe.com/28oeXG5xvgle4lW9AB';
      };

      const addToCart = (product) => {
        setCart([...cart, product]);
      };

      // Check for purchased items (after redirect from Stripe)
      useEffect(() => {
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session_id');
        const download = urlParams.get('download');
        
        // Prevent duplicate purchases by checking localStorage
        const processedSessions = JSON.parse(localStorage.getItem('processedSessions') || '[]');
        
        if (sessionId && !processedSessions.includes(sessionId)) {
          fetch(`/api/verify-purchase/${sessionId}`)
            .then(res => res.json())
            .then(data => {
              if (data.purchased) {
                if (data.isCartPurchase) {
                  // Multiple products purchased
                  setPurchasedItems(prevItems => {
                    // Filter out any duplicates by ID
                    const existingIds = prevItems.map(item => item.id);
                    const newItems = data.products.filter(product => !existingIds.includes(product.id));
                    return [...prevItems, ...newItems];
                  });
                } else {
                  // Single product purchase
                  setPurchasedItems(prevItems => {
                    // Check if this product is already in the list
                    if (!prevItems.some(item => item.id === data.product.id)) {
                      return [...prevItems, data.product];
                    }
                    return prevItems;
                  });
                }
                
                // Mark this session as processed
                processedSessions.push(sessionId);
                localStorage.setItem('processedSessions', JSON.stringify(processedSessions));
                
                // If this is a redirect after successful payment, show the chatbot
                if (download === 'true') {
                  setShowChatbot(true);
                }
              }
            })
            .catch(err => console.error('Error verifying purchase:', err));
        }
      }, []);

      // Filter products based on active category and search term
      const filteredProducts = products.filter(product => {
        const matchesCategory = activeCategory === 'All' || product.category === activeCategory;
        const matchesSearch = product.title.toLowerCase().includes(searchTerm.toLowerCase()) || 
                             product.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                             product.tags.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()));
        return matchesCategory && matchesSearch;
      });

      // Get all unique categories
      const categories = ['All', ...new Set(products.map(product => product.category))];

      // Featured products
      const featuredProducts = products.filter(product => product.featured);

      // Star rating component
      const ProductPreviewModal = ({ product, onClose }) => {
        if (!product) return null;
        
        return (
          <div className="fixed inset-0 flex items-center justify-center z-50" onClick={onClose}>
            <div className="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm"></div>
            <div className="glass relative rounded-xl w-full max-w-lg p-6 shadow-2xl shadow-cyan-500/20 animate-fadeIn" onClick={e => e.stopPropagation()}>
              <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-400 to-blue-500"></div>
              
              <button 
                className="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors"
                onClick={onClose}
              >
                <i className="fas fa-times"></i>
              </button>

              <div className="flex flex-col md:flex-row gap-6">
                <div className="w-full md:w-1/2">
                  <img 
                    src={product.image} 
                    alt={product.title}
                    className="w-full h-64 object-cover rounded-lg"
                  />
                  {product.category === 'Audio' && (
                    <div className="mt-4 glass p-4 rounded-lg">
                      <h4 className="text-cyan-400 mb-2 flex items-center gap-2">
                        <i className="fas fa-headphones"></i>
                        <span>Preview Audio</span>
                      </h4>
                      <audio 
                        controls 
                        className="w-full custom-audio-player"
                        src={product.previewUrl || product.fileUrl}
                      >
                        Your browser does not support the audio element.
                      </audio>
                    </div>
                  )}
                </div>
                
                <div className="w-full md:w-1/2">
                  <h3 className="text-2xl font-bold mb-2">{product.title}</h3>
                  <p className="text-cyan-400 text-xl mb-4">${product.price.toFixed(2)}</p>
                  <div className="flex items-center gap-2 mb-4">
                    <StarRating rating={product.rating} />
                    <span className="text-gray-400">({product.reviews} reviews)</span>
                  </div>
                  <p className="text-gray-300 mb-4">{product.description}</p>
                  <div className="flex flex-wrap gap-2 mb-4">
                    {product.tags.map(tag => (
                      <span key={tag} className="px-3 py-1 rounded-full bg-gray-800 text-gray-300 text-sm">
                        #{tag}
                      </span>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      const StarRating = ({ rating }) => {
        const fullStars = Math.floor(rating);
        const hasHalfStar = rating % 1 >= 0.5;
        const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
        
        return (
          <div className="flex items-center">
            {[...Array(fullStars)].map((_, i) => (
              <i key={`full-${i}`} className="fas fa-star text-yellow-400"></i>
            ))}
            {hasHalfStar && <i className="fas fa-star-half-alt text-yellow-400"></i>}
            {[...Array(emptyStars)].map((_, i) => (
              <i key={`empty-${i}`} className="far fa-star text-yellow-400"></i>
            ))}
            <span className="ml-1 text-gray-400 text-sm">({rating})</span>
          </div>
        );
      };

      // Product card component
      const ProductCard = ({ product, onPreview }) => {
        return (
          <div className="card-3d glass rounded-lg overflow-hidden transition-all duration-300 h-full flex flex-col">
            <div className="relative overflow-hidden">
              {product.featured && (
                <div className="absolute top-0 right-0 bg-gradient-to-r from-pink-500 to-purple-500 text-white text-xs font-bold px-3 py-1 rounded-bl-lg z-10">
                  Featured
                </div>
              )}
              <img 
                src={product.image} 
                alt={product.title} 
                className="w-full h-48 object-cover transition-transform duration-500 hover:scale-110 cursor-pointer" 
                onClick={() => onPreview(product)}
              />
            </div>
            <div className="p-5 flex-grow flex flex-col card-content">
              <div className="flex justify-between items-start mb-2">
                <h2 className="text-xl font-semibold neon-text">{product.title}</h2>
                <span className="bg-cyan-500/20 text-cyan-400 text-xs px-2 py-1 rounded">{product.category}</span>
              </div>
              <StarRating rating={product.rating} />
              <p className="text-gray-400 text-sm mt-2 mb-4 flex-grow">{product.description}</p>
              <div className="flex flex-wrap gap-1 mb-3">
                {product.tags.map(tag => (
                  <span key={tag} className="text-xs bg-gray-800 text-gray-300 px-2 py-1 rounded-full">{tag}</span>
                ))}
              </div>
              <p className="text-cyan-400 text-2xl font-bold mb-4">${product.price.toFixed(2)}</p>
              <div className="flex gap-2">
                <button
                  onClick={() => addToCart(product)}
                  className="flex-1 bg-cyan-500 text-black px-4 py-2 rounded hover:bg-cyan-400 transition-all duration-300 flex items-center justify-center gap-2"
                >
                  <i className="fas fa-shopping-cart"></i>
                  <span>Add to Cart</span>
                </button>
                <button
                  onClick={() => initiateCheckout(product)}
                  className="flex-1 bg-gradient-to-r from-cyan-500 to-blue-500 text-black px-4 py-2 rounded hover:from-cyan-400 hover:to-blue-400 transition-all duration-300 flex items-center justify-center gap-2"
                >
                  <i className="fas fa-bolt"></i>
                  <span>Buy Now</span>
                </button>
              </div>
            </div>
          </div>
        );
      };

      return (
        <div className="min-h-screen">
          <ProductPreviewModal product={previewProduct} onClose={() => setPreviewProduct(null)} />
          <Navigation 
            cart={cart} 
            setIsCartOpen={setIsCartOpen} 
            isCartOpen={isCartOpen} 
            currentUser={currentUser}
            onOpenAuthModal={(tab) => {
              setActiveAuthTab(tab);
              setIsAuthModalOpen(true);
            }}
            onSignOut={handleSignOut}
          />
          <Hero />
          
          {/* Auth Modal */}
          <AuthModal 
            isOpen={isAuthModalOpen} 
            onClose={() => setIsAuthModalOpen(false)}
            activeTab={activeAuthTab}
            setActiveTab={setActiveAuthTab}
          />
          
          <div className="max-w-7xl mx-auto px-6 py-20" id="products">
            {/* Featured Products Section */}
            <div className="mb-20">
              <h2 className="text-3xl font-bold header-text mb-8 flex items-center">
                <i className="fas fa-star text-yellow-400 mr-3"></i>
                Featured Products
              </h2>
              <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
                {featuredProducts.map(product => (
                  <ProductCard key={product.id} product={product} onPreview={setPreviewProduct} />
                ))}
              </div>
            </div>
            
            {/* All Products Section */}
            <h2 className="text-3xl font-bold header-text mb-8">Browse All Products</h2>
            
            {/* Search and Filter */}
            <div className="mb-8 flex flex-col md:flex-row gap-4 justify-between items-center">
              <div className="relative w-full md:w-1/3">
                <input 
                  type="text" 
                  placeholder="Search products..." 
                  className="w-full bg-gray-900/50 border border-gray-700 rounded-lg py-2 px-4 pl-10 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all duration-300"
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                />
                <i className="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              
              <div className="flex gap-2 overflow-x-auto pb-2 w-full md:w-auto">
                {categories.map(category => (
                  <button 
                    key={category} 
                    className={`px-4 py-2 rounded-full transition-all duration-300 whitespace-nowrap ${activeCategory === category ? 'bg-cyan-500 text-black font-bold' : 'bg-gray-800 text-white hover:bg-gray-700'}`}
                    onClick={() => setActiveCategory(category)}
                  >
                    {category}
                  </button>
                ))}
              </div>
            </div>
            
            {/* Products Grid */}
            {filteredProducts.length > 0 ? (
              <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
                {filteredProducts.map(product => (
                  <ProductCard key={product.id} product={product} onPreview={setPreviewProduct} />
                ))}
              </div>
            ) : (
              <div className="text-center py-20">
                <i className="fas fa-search text-5xl text-gray-600 mb-4"></i>
                <p className="text-xl text-gray-400">No products found matching your criteria</p>
                <button 
                  className="mt-4 px-4 py-2 bg-cyan-500 text-black rounded hover:bg-cyan-400 transition-all duration-300"
                  onClick={() => {
                    setActiveCategory('All');
                    setSearchTerm('');
                  }}
                >
                  Reset Filters
                </button>
              </div>
            )}
          </div>

          {/* Cart Section */}
          <div className={`mt-20 glass rounded-xl p-6 transition-all duration-500 max-w-4xl mx-auto ${isCartOpen ? 'ring-4 ring-cyan-400 shadow-lg shadow-cyan-400/30 scale-[1.01]' : ''}`} id="cart">
            <h2 className="text-3xl font-bold header-text mb-8 flex items-center">
              <i className="fas fa-shopping-cart text-cyan-400 mr-3"></i>
              Your Cart ({cart.length})
            </h2>
            
            {cart.length === 0 ? (
              <div className="text-center py-16 flex flex-col items-center">
                <div className="w-20 h-20 rounded-full bg-gray-800 flex items-center justify-center mb-4">
                  <i className="fas fa-shopping-cart text-3xl text-gray-500"></i>
                </div>
                <p className="text-xl text-gray-400 mb-4">Your cart is empty</p>
                <p className="text-gray-500 mb-6 max-w-md">Looks like you haven't added any items to your cart yet. Browse our products and find something you'll love!</p>
                <button 
                  onClick={() => document.getElementById('products').scrollIntoView({ behavior: 'smooth' })}
                  className="glow-button px-6 py-2 rounded-md"
                >
                  Browse Products
                </button>
              </div>
            ) : (
              <div>
                <div className="overflow-x-auto">
                  <table className="w-full table-auto">
                    <thead>
                      <tr className="border-b border-gray-800">
                        <th className="py-3 text-left w-3/5">Product</th>
                        <th className="py-3 text-center w-1/5">Price</th>
                        <th className="py-3 text-center w-1/5">Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      {cart.map((item, index) => (
                        <tr key={index} className="border-b border-gray-800 hover:bg-gray-800/50 transition-colors">
                          <td className="py-4">
                            <div className="flex items-center">
                              <img src={item.image} alt={item.title} className="w-12 h-12 object-cover rounded mr-3" />
                              <div>
                                <h3 className="font-semibold">{item.title}</h3>
                                <p className="text-gray-400 text-sm">{item.category}</p>
                              </div>
                            </div>
                          </td>
                          <td className="py-4 text-center">
                            <span className="text-cyan-400 font-bold">${item.price.toFixed(2)}</span>
                          </td>
                          <td className="py-4 text-center">
                            <div className="flex justify-center gap-2">
                              <button
                                onClick={() => initiateCheckout(item)}
                                className="bg-gradient-to-r from-cyan-500 to-blue-500 text-black px-3 py-1 rounded hover:from-cyan-400 hover:to-blue-400 transition-all duration-300"
                              >
                                Checkout
                              </button>
                              <button
                                onClick={() => {
                                  const newCart = [...cart];
                                  newCart.splice(index, 1);
                                  setCart(newCart);
                                }}
                                className="bg-gray-700 text-white px-3 py-1 rounded hover:bg-gray-600 transition-all duration-300"
                              >
                                <i className="fas fa-trash-alt"></i>
                              </button>
                            </div>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
                
                <div className="mt-6 flex flex-col md:flex-row justify-between items-center gap-4">
                  <div className="text-xl">
                    <span className="text-gray-400">Total: </span>
                    <span className="text-cyan-400 font-bold">
                      ${cart.reduce((total, item) => total + item.price, 0).toFixed(2)}
                    </span>
                  </div>
                  <button
                    onClick={() => initiateCheckout(cart)}
                    className="w-full md:w-auto bg-gradient-to-r from-cyan-500 to-blue-500 text-black px-6 py-2 rounded-md hover:from-cyan-400 hover:to-blue-400 transition-all duration-300 flex items-center justify-center gap-2 font-bold"
                  >
                    <i className="fas fa-credit-card"></i>
                    <span>Checkout All Items</span>
                  </button>
                </div>
              </div>
            )}
          </div>

          {/* Purchases Section */}
          {purchasedItems.length > 0 && (
            <div className="mt-20 glass rounded-xl p-6" id="purchases">
              <h2 className="text-3xl font-bold header-text mb-8 flex items-center">
                <i className="fas fa-download text-cyan-400 mr-3"></i>
                Your Purchases
              </h2>
              <div className="grid sm:grid-cols-2 gap-6">
                {purchasedItems.map((item, index) => (
                  <div key={index} className="glass rounded-lg p-4 flex justify-between items-center hover:bg-gray-800/50 transition-all duration-300">
                    <div className="flex items-center">
                      <img src={item.image} alt={item.title} className="w-16 h-16 object-cover rounded mr-4" />
                      <div>
                        <h3 className="font-semibold">{item.title}</h3>
                        <p className="text-gray-400 text-sm">Purchased on {new Date().toLocaleDateString()}</p>
                      </div>
                    </div>
                    <a
                      href={item.fileUrl}
                      download
                      className="download-btn text-black px-4 py-2 rounded flex items-center gap-2"
                    >
                      <i className="fas fa-download"></i>
                      <span>Download</span>
                    </a>
                  </div>
                ))}
              </div>
            </div>
          )}
          
          {/* Footer */}
          <footer className="mt-32 glass rounded-t-xl p-10">
            <div className="max-w-6xl mx-auto">
              <div className="flex flex-col md:flex-row justify-between items-center mb-10">
                <h2 className="text-3xl font-bold header-text mb-6 md:mb-0">Glow<span className="text-cyan-400">Cart</span></h2>
                <div className="flex gap-6">
                </div>
              </div>
              
              <div className="grid md:grid-cols-4 gap-8 mb-10">
                <div>
                  <h3 className="text-lg font-bold mb-4">Shop</h3>
                  <ul className="space-y-2">
                    <li><a href="#" className="text-gray-400 hover:text-cyan-400 transition-colors duration-300">All Products</a></li>
                    <li><a href="#" className="text-gray-400 hover:text-cyan-400 transition-colors duration-300">Featured</a></li>
                    <li><a href="#" className="text-gray-400 hover:text-cyan-400 transition-colors duration-300">New Arrivals</a></li>
                    <li><a href="#" className="text-gray-400 hover:text-cyan-400 transition-colors duration-300">Pricing</a></li>
                  </ul>
                </div>
                <div>
                  <h3 className="text-lg font-bold mb-4">Company</h3>
                  <ul className="space-y-2">
                    <li><a href="#" className="text-gray-400 hover:text-cyan-400 transition-colors duration-300">About Us</a></li>
                    <li><a href="#" className="text-gray-400 hover:text-cyan-400 transition-colors duration-300">Careers</a></li>
                    <li><a href="#" className="text-gray-400 hover:text-cyan-400 transition-colors duration-300">Press</a></li>
                    <li><a href="#" className="text-gray-400 hover:text-cyan-400 transition-colors duration-300">News</a></li>
                  </ul>
                </div>
                <div>
                  <h3 className="text-lg font-bold mb-4">Support</h3>
                  <ul className="space-y-2">
                    <li><a href="#" className="text-gray-400 hover:text-cyan-400 transition-colors duration-300">Contact Us</a></li>
                    <li><a href="#" className="text-gray-400 hover:text-cyan-400 transition-colors duration-300">FAQ</a></li>
                    <li><a href="#" className="text-gray-400 hover:text-cyan-400 transition-colors duration-300">Returns</a></li>
                    <li><a href="#" className="text-gray-400 hover:text-cyan-400 transition-colors duration-300">Live Chat</a></li>
                  </ul>
                </div>
                <div>
                  <h3 className="text-lg font-bold mb-4">Stay Updated</h3>
                  <p className="text-gray-400 mb-4">Subscribe to our newsletter for the latest updates and offers.</p>
                  <div className="flex">
                    <input type="email" placeholder="Your email" className="bg-gray-800 text-white px-4 py-2 rounded-l focus:outline-none focus:ring-2 focus:ring-cyan-500 w-full" />
                    <button className="bg-cyan-500 text-black px-4 py-2 rounded-r hover:bg-cyan-400 transition-colors duration-300">
                      <i className="fas fa-paper-plane"></i>
                    </button>
                  </div>
                </div>
              </div>
              
              <div className="pt-8 border-t border-gray-800 text-center text-gray-500">
                <p>© {new Date().getFullYear()} GlowCart. All rights reserved.</p>
                <div className="flex justify-center gap-6 mt-4">
                  <a href="#" className="text-gray-500 hover:text-gray-400 transition-colors duration-300">Privacy Policy</a>
                  <a href="#" className="text-gray-500 hover:text-gray-400 transition-colors duration-300">Terms of Service</a>
                  <a href="#" className="text-gray-500 hover:text-gray-400 transition-colors duration-300">Cookie Policy</a>
                </div>
              </div>
            </div>
          </footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>